<!DOCTYPE html>
<html lang="ru">
{% load static %}

<head>

    <meta charset="UTF-8"/>
    <meta
            name="keywords"
            content="sawing teeth,machines,пильные зубья,гусеницы"
    />
    <meta name="author" content="Well"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" type="text/css" href="{% static 'styles/reset.css' %}?v=1.1"/>
    <link rel="stylesheet" type="text/css" href="{% static 'styles/main.css' %}?v=1.1"/>
    <link rel="stylesheet" type="text/css" href="{% static 'styles/header.css' %}?v=1.1"/>
    <link rel="stylesheet" type="text/css" href="{% static 'styles/hero.css' %}?v=1.1"/>
    <link rel="stylesheet" type="text/css" href="{% static 'styles/category.css'%}?v=1.1"/>
    <link rel="stylesheet" type="text/css" href="{% static 'styles/footer.css' %}?v=1.1"/>
    <link rel="stylesheet" type="text/css" href="{% static 'styles/category-chosen.css' %}?v=1.1"/>


    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap"
            rel="stylesheet"
    />
    {{ cart_data|json_script:"cart-data" }}
    <title>Well</title>
</head>
<body>
<!-- start header -->
{% include 'catalog/fixed/navbar.html' %}
<!-- end header -->

<!-- start main -->
<main>
    <div class="grey-stripe">
        <div class="container">
            <div class="resolution">
                <div class="nav-on-page">
                    Главная | <a class="current-link">Зубья</a>
                </div>
                <h3 class="category-item">Пильные зубья</h3>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="drop-list-brand">
            <div id="drop-trigger">
                Бренд <img src="assets\svgs\arrow-down.svg" class="down-arrow"/>
            </div>
            <div class="content">
                <div class="drop-list-brand__item">
                    <input
                            class="checkbox-custom"
                            type="checkbox"
                            id="brand1"
                            name="brand1"
                            value="brand1"
                    />
                    <label for="brand1">Bandit</label><br/>
                </div>
                <div class="drop-list-brand__item">
                    <input
                            class="checkbox-custom"
                            type="checkbox"
                            id="brand1"
                            name="brand1"
                            value="brand1"
                    />
                    <label for="brand1">Bandit</label><br/>
                </div>
                <div class="drop-list-brand__item">
                    <input
                            class="checkbox-custom"
                            type="checkbox"
                            id="brand1"
                            name="brand1"
                            value="brand1"
                    />
                    <label for="brand1">Bandit</label><br/>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <section class="items-sec">
            <ul class="category-item__list">
                <div class="container-fixed">
                    {% for item in items %}
                    <li class="category-items__item">
                        <div class="category-item-link" href="item-of-category.html">
                            <a href="{% url 'item_detail' category_slug=category.slug item_id=item.id %}">
                                <img src="{{ item.main_picture.url }}" alt="category item">
                            </a>
                            <h6 class="name-of-brand">{{item.brand}}</h6>
                            <h6 class="vendor">#Q10233T</h6>
                            <button class="{% if item.id in cart_data %}add-to-cart-btn off{% else %}add-to-cart-btn on{% endif %}"
                                    id="{{ item.id }}" data-id="{{ item.id }}">
                                {% if item.id in cart_data %}Удалить{% else %}В корзину{% endif %}
                            </button>

                        </div>
                    </li>
                    {% endfor %}
                    {{cart_data}}
                </div>
                <div class="container-fixed">

                </div>
            </ul>
        </section>
    </div>
</main>
<!-- end main -->
<!-- start  footer -->
<footer>
    <div class="container-footer">
        <div class="top-footer">
            <img src="assets\svgs\shortend.svg" alt="w-short"/>
            <p class="footer-par">Вопросы по номеру</p>
            <address class="phone">+7 (800) 5534-228</address>
            <address class="mail">pochta@mail.ru</address>
        </div>
        <div class="navigation-footer-container">
            <p class="nav-footer">Навигация по сайту</p>
            <nav class="navigation-footer">
                <ul class="nav-footer__list">
                    <li class="nav-footer__item">
                        <a href="">Категория 1</a>
                    </li>
                    <li class="nav-footer__item">
                        <a href="">Категория 2</a>
                    </li>
                    <li class="nav-footer__item">
                        <a href="">Категория 3</a>
                    </li>
                    <li class="nav-footer__item">
                        <a href="">Категория 4</a>
                    </li>
                    <li class="nav-footer__item">
                        <a href="">Категория 5</a>
                    </li>
                    <li class="nav-footer__item">
                        <a href="">Категория 6</a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="footer-info-container">
            <h6 class="footer-info">
                Компания «Тимбермаш Байкал» - дилер спецтехники мировых брендов
                Sany, Merko, Mesda, HBXG (Shewa), Rotobec (RTB), Hangcha, YTO,
                Orthaus, CHC Nav, FJDynamics, Gehl, Manitou, John Deere, FAE,
                Waratah, Ponsse, Gregoire Bessone, Lucas. Мы предлагаем спецтехнику
                для дорожно-строительной, лесозаготовительной, сельскохозяйственной
                отрасли, а также оригинальные запчасти и качественный сервис.
                Тимбермаш Байкал - это надежная спецтехника в наличии и под заказ;
                передовые технологии в обслуживании техники; квалифицированные
                специалисты сервиса. Приобретайте спецтехнику в лизинг на выгодных
                условиях, действует услуга Trade-IN, предлагаем варианты техники со
                стажем (б/у).
            </h6>
        </div>
        <div class="credits">
            <p class="credits_txt">
                Designed and built with all the love in the world by the
                <a class="depo" href="">depo</a> .
                <span class="license"
                >Code licensed <a class="mit" href="">MIT</a></span
                >.
            </p>
        </div>
    </div>
    <div class="bottom-footer">
        <div class="dark-stripe">
            <span class="commerce">© Well, Russia. Все права защищены.</span>
        </div>
    </div>
</footer>
</body>
<script src="\static\scripts\main.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!--<script src="\static\scripts\hero.js"></script>-->
<script src="\static\scripts\index.js"></script>

<!--<script src="\static\scripts\category.js"></script>-->


<script>


</script>


<script>
$(document).ready(function() {
    // Инициализация всех кнопок


    const cartData = JSON.parse(document.getElementById('cart-data').textContent);
    console.log(cartData);


    $('button').each(function() {
        const buttonId = this.id; // Получаем id текущей кнопки

        // Проверяем значение в localStorage для каждой кнопки
        const value = localStorage.getItem(buttonId);
            if (value === '2' &&  buttonId in cartData ) {
            $(this).removeClass('on').addClass('off').text('Удалить');

        } else {
            $(this).removeClass('off').addClass('on').text('В корзину');
            localStorage.setItem(buttonId, '1');
        }
    });

    // Обработчик клика на все кнопки
    $('button').click(function(e) {
        e.preventDefault();
        var button = $(this);
        var itemId = button.data('id');

        var currentValue = parseInt(localStorage.getItem(itemId)) || 1;

        // Меняем значение на 1 или 2, в зависимости от текущего состояния
        if (currentValue === 1) {
            currentValue = 2;
            button.removeClass('on').addClass('off').text('Удалить');

        } else {
            currentValue = 1;
            button.removeClass('off').addClass('on').text('В корзину');

        }

        // Записываем новое значение в localStorage
        localStorage.setItem(itemId, currentValue);

        // Отправка AJAX запроса на добавление или удаление из корзины
        if (currentValue === 2) {
            $.ajax({
                type: 'POST',
                url: '{% url "basket:basket_add" %}',
                data: {
                    itemid: itemId,
                    itemqty: 1,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    action: 'post',
                },
                success: function(json) {
                    document.getElementById('basket-qty').innerHTML = json.qty;
                },
                error: function(xhr, errmsg, err) {
                    // Обработка ошибок при добавлении товара в корзину
                }
            });
        } else {
            $.ajax({
                type: 'POST',
                url: '{% url "basket:basket_delete" %}',
                data: {
                    itemid: itemId,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    action: 'delete',
                },
                success: function(json) {
                    document.getElementById('basket-qty').innerHTML = json.qty;
                },
                error: function(xhr, errmsg, err) {
                    // Обработка ошибок при удалении товара из корзины
                }
            });
        }
    });
});
</script>

</html>
<!-- end footer -->
